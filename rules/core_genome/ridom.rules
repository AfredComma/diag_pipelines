rule get_scheme_from_ridom:
    params:
        id_ridom=str(ridom.loc[config["species"], "id_number"])
    output:
        "core_genome/ridom/schemas.tsv"
    shell:
        """
        wget -qO- http://www.cgmlst.org/ncs/schema/{params.id_ridom}/locus/?content-type=csv > {output[0]}
        """
    
rule create_bed_from_schema:
    input:
        schema="core_genome/ridom/schemas.tsv",
        genome="references/{ref}/genome_fasta.fasta",
    output:
        bed="core_genome/ridom/{ref}.bed",
    shell:
        """    
        accession=$(head -n 1 {input[genome]} | cut -f1 -d ' ' | sed "s/>//") 
        echo ${{accession}}
        tail -n +2 {input[schema]} | cut -f4,5 | awk -v acc="${{accession}}" '{{print acc "\011" ($1 - 1) "\011" ($1 -1 + $2)}}' > {output[bed]}
        """
