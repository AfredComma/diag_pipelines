rule fetch_from_uniprot_accession:
    input:
        config["virulence_factors"]
    output:
        "virulence/log.txt"
    shell:
        """
        mkdir -p $(dirname {output[0]})/fastas/
        sed 1d {input[0]} | while read gene id description; do
            wget -qO- http://www.uniprot.org/uniprot/${{id}}.fasta > $(dirname {output[0]})/fastas/${{gene}}.fasta
            if [ ! -s  $(dirname {output[0]})/fastas/${{gene}}.fasta ]; then
                 echo "Error, ${{id}} not found on uniprot" 1>&2
                 exit 1
            else
                sed -i.bak "s/^>.*|${{id}}|/>${{gene}} ${{id}}|/" $(dirname {output[0]})/fastas/${{gene}}.fasta
            fi
        done
        echo "okay" > {output}
        """

        

