rule align_paired_reads_to_assembled_genome:
    conda:
        "../../envs/bwa-samtools.yaml"
    input:
        "samples/{sample}/assembly/spades/contigs_500bp_renamed.fasta",
        "samples/{sample}/reads/trimmed/R1_paired.fastq",
        "samples/{sample}/reads/trimmed/R2_paired.fastq",
    output:
        temp("samples/{sample}/mapping/bwa/{sample}.bam")
    log:
        logging_folder+"/samples/{sample}/logs/mapping_bwa_self.log"
    shell:
        """
        bwa index {input[0]}
        bwa mem -v 1 {input} -o {output[0]}.tmp &> {log}
        samtools sort -O BAM -o {output} {output[0]}.tmp
        rm {output[0]}.tmp
        samtools index {output[0]}
        """

rule align_single_reads_to_assembled_genome:
    conda:
        "../../envs/bwa-samtools.yaml"
    input:
        "samples/{sample}/assembly/spades/contigs.fasta.fsa",
        "samples/{sample}/reads/trimmed/single.fastq",
    output:
        temp("samples/{sample}/mapping/{sample}.bam")
    log:
        logging_folder+"/samples/{sample}/logs/mapping_bwa_self.log"
    shell:
        """
        bwa index {input[0]}
        bwa mem -v 1 {input} | samtools sort -O BAM -o {output} - > {log}
        samtools index {output[0]}
        """
