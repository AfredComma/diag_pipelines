rule mlst_samples:
    conda:
        "../../envs/mlst.yaml"
    input:
        expand("samples/{sample}/annotation/{sample}.fsa", sample=read_naming.keys())
    output:
        "typing/mlst/summary.tsv"
    shell:
        """
        mlst --quiet {input} | sed "s/.*\///" | sed "s/\.fsa//"  > {output[0]}
        """

rule mlst_reference_fasta:
    conda:
        "../../envs/mlst.yaml"
    input:
        genome="references/{ref}/genome_fasta.fasta"
    output:
        "references/{ref}/mlst.tsv"
    shell:
        """
        mlst --quiet {input[genome]}  | sed "s/.*\///" | sed "s/_genome\.fasta//" > {output[0]}
        """

rule mlst_to_excel:
    conda:
        "../../envs/pandas-openpyxl-pronto-xlrd.yaml"
    input:
        "typing/mlst/{file}.tsv"
    output:
        "typing/mlst/{file}.xlsx"
    script:
        "scripts/mlst_csv_to_xlsx.py"
