rule mlst_samples:
    conda:
        "env/mlst.yaml"
    input:
        expand("strains/{sample}/annotation/{sample}.fsa", sample=read_naming.keys())
    output:
        "typing/mlst/summary.tsv"
    shell:
        """
        mlst --quiet! {input} | sed "s/.*\///" | sed "s/\.fsa//"  > {output[0]}
        """

rule mlst_all_complete_genomes_fasta:
    conda:
        "env/mlst.yaml"
    input:
        "references/all_complete_genomes_log.txt"
    output:
        "typing/mlst/references.tsv"
    shell:
        """
        mlst --quiet! $(dirname {input[0]})/all_complete_genomes/*.fasta | sed "s/.*\///" | sed "s/_genome\.fasta//" > {output[0]}
        """

rule mlst_to_excel:
    conda:
        "env/pandas-openpyxl-xlrd.yaml"
    input:
        "typing/mlst/{file}.tsv"
    output:
        "typing/mlst/{file}.xlsx"
    script:
        "scripts/mlst_csv_to_xlsx.py"
