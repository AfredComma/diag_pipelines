rule normalize_and_vt_decompose_from_freebayes:
    conda:
        "../../envs/vt-bcftools.yaml"
    input:
        vcf="{any_vcf}.raw.vcf.gz",
        vcf_tbi="{any_vcf}.raw.vcf.gz.tbi",
        ref=ancient("references/{ref}/genome_fasta.fasta"),
    output:
        normalized="{any_vcf}.vcf"
    log:
        logging_folder+"/{any_vcf}_vt_normalize.txt"
    shell:
        """
        bcftools norm -f {input[ref]} -m -any {input[vcf]} | vt decompose_blocksub - | bcftools norm -m +any > {output[normalized]}
        """
