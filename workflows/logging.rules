from shutil import copyfile
import sys
import datetime
import os


if "absolute_path_of_pipeline_folder" not in config.keys():
    absolute_path = "/home/pipeline_user/snakemake_pipeline/"
else:
    absolute_path = config["absolute_path_of_pipeline_folder"]

if "logging_folder" not in config.keys():
    logging_folder = "logs"
else:
    logging_folder=config["logging_folder"]

if "--dryrun" not in sys.argv and "-n" not in sys.argv:
    today = datetime.datetime.now()
    date = today.strftime("%Y/%m/%d")
    time = today.strftime('%H_%M_%S_%f')[:-4]
    logging_folder = config["logging_folder"]+"/"+date+"/"+time
    logging_folder = logging_folder.replace("//", "/")
    os.makedirs(logging_folder, exist_ok=True)
    cmd_file = logging_folder + "/cmd.txt"
    with open(cmd_file, "w") as f:
        f.write(" ".join(sys.argv)+"\n")
    copyfile(workflow.overwrite_configfile, logging_folder+"/config.yaml")
    if "local_samples" in config.keys():
        copyfile(config["local_samples"], logging_folder+"/local_samples.tsv")
    if "sra_samples" in config.keys():
        copyfile(config["sra_samples"], logging_folder+"/sra_samples.tsv")
else:
    logging_folder=""
